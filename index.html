<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Mallouk Bike</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://i.postimg.cc/kgrvnzGZ/image-2-Photoroom.png">
  <link rel="apple-touch-icon" href="https://i.postimg.cc/kgrvnzGZ/image-2-Photoroom.png">
  <meta name="theme-color" content="#34d399">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;600;500;400&family=Almarai:wght@700;600;400&family=Tajawal:wght@700;500;400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --gradient: linear-gradient(90deg,#00A115 0%,#00a115 100%);
      --whatsapp-gradient: linear-gradient(90deg, #25d366 0%, #128c7e 100%);
      --glass-bg: rgba(255, 255, 255, 0);
      --glass-blur: blur(10px);
      --green: #000000;
      --turquoise: #5eead4;
      --gold: #ffd94a;
      --danger: #d9303e;
      --info: #3191e1;
      --gray: #f6fcff;
      --yellow-hl: #ffe066;
    }
    html {box-sizing: border-box;}
    *,*:before,*:after {box-sizing: inherit;}
    body {
      font-family:'Cairo', 'Tajawal', 'Almarai', Arial, sans-serif;
      background: var(--gray);
      margin: 0;
      color:#223;
      min-height: 100vh;
      direction: rtl;
      text-align: right;
    }
    .header {
      position: relative;
      text-align:center;
      padding:40px 10px 20px;
      background: var(--gradient);
      background-size: 150% 150%;
      animation: gradientBG 6s ease-in-out infinite alternate;
      border-bottom: 1.5px solid #eafff4;
      box-shadow: 0 6px 40px #34d39933;
      z-index: 10;
    }
    @keyframes gradientBG {
      to {background-position: 100% 100%;}
    }
    .glass {
      background: var(--glass-bg);
      box-shadow: 0 4px 32px #34d39922;
      backdrop-filter: var(--glass-blur);
      border-radius: 18px;
      padding: 16px 24px;
      display: inline-block;
      margin-bottom: 18px;
    }
    .logo {
      width: 80px;
      border-radius:50%;
      box-shadow:0 4px 24px #ffd94aaa;
      margin-bottom: 14px;
      background: #fff;
    }
    .title {
      font-size:2.2em;
      font-weight:700;
      color:#fff;
      letter-spacing:1.2px;
      text-shadow: 0 2px 11px #34d39988;
      margin-bottom: 9px;
      font-family:'Cairo', 'Almarai', 'Tajawal', Arial, sans-serif;
    }
    .subtitle{
      color:#fffbe5;
      font-size:1.12em;
      font-weight:600;
      text-shadow:0 2px 12px #34d39955;
      margin-bottom: 14px;
      font-family:'Cairo', 'Tajawal', 'Almarai', Arial, sans-serif;
    }
    .search-bar-box {
      margin: 0 auto 0;
      max-width: 460px;
      display: flex;
      align-items: center;
      position: relative;
      justify-content: center;
      flex-direction: row-reverse;
    }
    .search-bar {
      width: 100%;
      font-family: inherit;
      padding: 13px 18px 13px 44px;
      border-radius: 15px;
      border: none;
      font-size: 1.05em;
      background: rgba(255,255,255,0.7);
      box-shadow: 0 2px 18px #34d39915;
      transition: box-shadow 0.2s;
      outline: none;
      color: #223;
      direction: rtl;
      text-align: right;
    }
    .search-bar:focus {
      box-shadow: 0 4px 18px #34d39944;
      border: 1.8px solid var(--turquoise);
    }
    .search-icon {
      position: absolute;
      left: 19px;
      font-size: 1.3em;
      color: var(--green);
      pointer-events: none;
    }
    .whatsapp-contact-row {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 18px 0 0 0;
      width: 100%;
    }
    .whatsapp-contact-btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: var(--whatsapp-gradient);
      color: #fff;
      font-size: 1.16em;
      font-weight: 700;
      border: none;
      border-radius: 36px;
      padding: 10px 26px 10px 20px;
      box-shadow: 0 2px 16px #25d36644;
      cursor: pointer;
      text-decoration: none;
      transition: box-shadow 0.18s, transform 0.17s, background 0.14s;
      outline: none;
      direction: rtl;
      min-width: 0;
      will-change: transform, box-shadow;
      position: relative;
      z-index: 11;
      animation: fadeInScale 0.65s cubic-bezier(.23,.7,.52,1.02) 0.1s both;
    }
    .whatsapp-contact-btn:focus {
      outline: 2.5px solid #128c7e;
      outline-offset: 2px;
      box-shadow: 0 0 0 3px #25d36633;
    }
    .whatsapp-contact-btn:hover {
      box-shadow: 0 6px 28px #25d36677;
      transform: scale(1.045);
      background: linear-gradient(90deg,#26e265 0%,#119e7e 100%);
    }
    .whatsapp-contact-btn:active {
      transform: scale(1.02);
    }
    .whatsapp-contact-btn .fa-whatsapp {
      font-size: 1.45em;
      color: #fff;
      margin-left: 0;
      margin-right: 0;
      filter: drop-shadow(0 2px 8px #128c7e33);
    }
    @keyframes fadeInScale {
      0% { opacity: 0; transform: scale(0.8) translateY(-12px); }
      60% { opacity: 1; transform: scale(1.04) translateY(5px); }
      100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    @media (max-width: 600px) {
      .whatsapp-contact-row {
        margin: 12px 0 0 0;
      }
      .whatsapp-contact-btn {
        width: 95vw;
        font-size: 1em;
        padding: 10px 0 10px 0;
        border-radius: 17px;
        justify-content: center;
      }
    }
    .category-filters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 13px;
      margin: 24px 0 12px;
      flex-direction: row-reverse;
    }
    .filter-btn {
      padding: 8px 20px;
      border-radius: 10px;
      border: none;
      font-family: 'Cairo', 'Almarai', 'Tajawal', Arial;
      font-weight: 700;
      background: linear-gradient(90deg, #eafff4 0%, #fffbe5 70%);
      color: var(--green);
      cursor: pointer;
      box-shadow: 0 2px 10px #34d39915;
      transition: background 0.18s, box-shadow 0.22s, color 0.18s, transform 0.22s;
      position: relative;
      outline: none;
    }
    .filter-btn.active {
      background: var(--gradient);
      color: #fff;
      box-shadow: 0 4px 20px #34d39933;
      transform: scale(1.08);
    }
    .filter-btn:active::after {
      content: '';
      position: absolute;
      right: 50%;
      top: 50%;
      width: 100%;
      height: 100%;
      transform: translate(50%,-50%) scale(1.1);
      background: rgba(52,211,153,0.13);
      border-radius: 10px;
      z-index: 1;
      animation: rippleBtn 0.3s linear;
    }
    @keyframes rippleBtn {
      to {opacity:0; transform:translate(50%,-50%) scale(2);}
    }
    .counter {
      text-align:center;
      margin: 10px auto 0;
      color: var(--green);
      font-weight: 700;
      font-size:1.05em;
    }
    .add-bike-form {
      max-width:440px;
      margin:36px auto 0;
      background: #fff;
      border-radius:18px;
      box-shadow:0 3px 22px #34d39919;
      padding:28px 18px 18px;
      position: relative;
      overflow: visible;
      direction: rtl;
      text-align: right;
    }
    .add-bike-form .form-title {
      font-weight:700;
      font-size:1.18em;
      color:var(--green);
      margin-bottom:14px;
      letter-spacing:0.5px;
      font-family:'Cairo', 'Almarai', 'Tajawal', Arial, sans-serif;
    }
    .add-bike-form input[type="text"], .add-bike-form select {
      width:100%;
      margin-bottom:10px;
      padding:11px;
      border-radius:11px;
      border:1.7px solid #eee;
      font-size:1em;
      font-family:inherit;
      background: #f9f9f9;
      transition: border 0.2s;
      direction: rtl;
      text-align: right;
    }
    .add-bike-form input[type="text"]:focus, .add-bike-form select:focus {
      outline:none;
      border-color:var(--green);
      background: #f6fcff;
    }
    .add-bike-form input[type="file"] {
      width:100%;
      margin-bottom:10px;
      padding:10px;
      border-radius:11px;
      border:1.7px solid #eee;
      font-size:0.97em;
      font-family:inherit;
      background:#f9f9f9;
    }
    .add-bike-form input[type="file"]:focus {
      outline:none;
      border-color:var(--green);
    }
    .add-bike-form .add-btn {
      background: var(--gradient);
      color: #fff;
      border: none;
      border-radius: 11px;
      padding: 11px 30px;
      font-size:1.08em;
      font-weight:700;
      cursor:pointer;
      font-family:'Cairo', 'Tajawal', 'Almarai', Arial;
      box-shadow: 0 2px 12px #34d39921;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.2s, transform 0.19s;
      display: flex;
      align-items: center;
      gap: 7px;
      flex-direction: row-reverse;
    }
    .add-bike-form .add-btn:active::after {
      content: '';
      position: absolute;
      right: 50%;
      top: 50%;
      width: 100%;
      height: 100%;
      transform: translate(50%,-50%) scale(1.1);
      background: rgba(52,211,153,0.13);
      border-radius: 11px;
      z-index: 1;
      animation: rippleBtn 0.3s linear;
    }
    .add-bike-form .msg {
      margin-right:13px;
      font-size:0.98em;
      font-weight:600;
      position: absolute;
      left: 24px;
      top: 19px;
      direction: rtl;
      text-align: right;
    }
    .add-bike-form .loading {
      display: inline-block;
      width: 22px;
      height: 22px;
      border: 3px solid #34d39933;
      border-top: 3px solid #34d399;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      vertical-align: middle;
      margin-right:7px;
      margin-left:0;
    }
    @keyframes spin {
      to {transform: rotate(360deg);}
    }
    .bikes-list {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(290px,1fr));
      gap:32px;
      max-width:1080px;
      margin:42px auto 0;
      padding:0 12px;
      min-height: 120px;
      transition: min-height 0.3s;
      direction: rtl;
      text-align: right;
    }
    .no-result {
      text-align:center;
      color: #d9303e;
      font-size:1.07em;
      background: #fff2f2;
      border-radius: 13px;
      margin: 30px auto 0;
      padding: 24px 15px;
      max-width: 420px;
      box-shadow: 0 2px 12px #d9303e11;
      animation: fadeIn 0.4s;
      direction: rtl;
    }
    .bike-card {
      background:#fff;
      box-shadow:0 4px 32px #34d39925;
      padding:30px 18px 20px;
      border-radius:22px;
      display:flex;
      flex-direction:column;
      align-items:center;
      position:relative;
      animation: fadeIn 0.7s cubic-bezier(.24,.93,.63,1.08);
      opacity: 0;
      transform: scale(0.97) translateY(12px);
      animation-fill-mode: forwards;
      direction: rtl;
      text-align: right;
      border: 3px solid transparent;
      transition: border 0.27s, box-shadow 0.17s;
    }
    .bike-card.product-highlight {
      border: 3px solid var(--yellow-hl);
      box-shadow: 0 0 40px 0 var(--yellow-hl), 0 4px 32px #34d39925;
      z-index: 2;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.97) translateY(12px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .bike-card:hover {
      box-shadow:0 8px 44px #34d39938;
      transform: scale(1.03) perspective(700px) rotateY(2deg) rotateX(2deg);
      transition: box-shadow 0.25s, transform 0.3s;
    }
    .badge {
      position:absolute;
      top:18px;
      right:21px;
      padding:7px 18px;
      font-weight:700;
      border-radius:10px;
      font-size:1em;
      box-shadow: 0 2px 8px #fffbe599;
      letter-spacing: 1px;
      z-index: 1;
      color: #fff;
      font-family:'Cairo', 'Tajawal', 'Almarai', Arial;
    }
    .badge.vtt {background: linear-gradient(90deg,#00c3a0 0%,#34d399 90%);}
    .badge.route {background: linear-gradient(90deg,#3191e1 0%,#5eead4 80%);}
    .badge.trottinette {background: linear-gradient(90deg,#b7c800 0%,#ffd94a 90%); color: #876200;}
    .badge.accessoires {background: linear-gradient(90deg,#f88372 0%,#ffd94a 70%); color: #876200;}
    .badge.mecanique {background: linear-gradient(90deg,#d9303e 0%,#34d399 70%);}
    .badge.enfant {background: linear-gradient(90deg,#f7b2d9 0%,#5eead4 80%);}
    .badge.malhekat {background: linear-gradient(90deg,#9333ea 0%,#c084fc 80%); color: #fff;}
    .bike-img {
      width:95%; max-width:210px;height:140px;object-fit:cover; border-radius:13px;background:#eafff4;box-shadow:0 2px 11px #1de9b622;margin-bottom:11px; cursor:zoom-in; transition: transform 0.18s, box-shadow 0.2s;
    }
    .bike-card:hover .bike-img {
      transform: scale(1.08) rotateZ(2deg);
      box-shadow: 0 4px 22px #34d39933;
    }
    .bike-name {
      font-size:1.16em;
      font-weight:700;
      color:var(--green);
      letter-spacing:.6px;
      background:#d9ffd3;
      width:fit-content;
      padding:8px 27px;
      border-radius:13px;
      margin-bottom: 8px;
      box-shadow: 0 2px 12px #34d39918;
      font-family: 'Cairo', 'Almarai', 'Tajawal';
    }
    .bike-desc {
      font-size:0.98em;
      color:#444;
      background: #f6fcff;
      border-radius: 7px;
      padding: 8px 13px;
      margin-bottom: 10px;
      text-align: center;
      min-height: 32px;
      font-family: inherit;
      letter-spacing: 0.2px;
      direction: rtl;
    }
    .card-btns {
      display: flex;
      gap: 9px;
      margin-top: 13px;
      flex-direction: row-reverse;
    }
    .share-btn, .delete-btn {
      background: var(--gradient);
      color: #fff;
      font-family:'Cairo', 'Almarai', 'Tajawal', Arial,sans-serif;
      font-weight:700;
      border:none;
      border-radius:11px;
      padding:10px 26px;
      font-size:1em;
      box-shadow:0 2px 10px #34d39921;
      cursor:pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.2s, transform 0.17s;
      flex-direction: row-reverse;
    }
    .share-btn:active, .delete-btn:active {
      box-shadow:0 4px 20px #34d39933;
      transform: scale(1.06);
    }
    .delete-btn {
      background: linear-gradient(90deg,#d9303e 0%,#ffd94a 90%);
      color:#fff;
    }
    .delete-btn:active {
      box-shadow:0 4px 20px #d9303e33;
      transform: scale(1.07);
    }
    .footer {
      text-align:center;
      padding:22px 14px 10px;
      color:var(--green);
      font-size:1em;
      margin-top:48px;
      background: linear-gradient(90deg,#5eead4 0%,#fffbe5 100%);
      border-radius: 0 0 18px 18px;
      box-shadow: 0 -2px 28px #34d39922;
      direction: rtl;
    }
    .popup-overlay {
      position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(44,221,153,.14);backdrop-filter:blur(4px);display:none;justify-content:center;align-items:center;z-index:1000;
    }
    .popup-overlay.active{display:flex;}
    .popup-img-box{
      background:var(--glass-bg);
      box-shadow:0 8px 44px #34d39933;border-radius:23px;padding:22px;display:flex;flex-direction:column;align-items:center;position:relative;max-width:90vw;max-height:90vh;
      backdrop-filter: blur(11px);
      animation: fadeIn 0.3s;
      direction: rtl;
      text-align: right;
    }
    .popup-img{max-width:100%; max-height:80vh; border-radius:16px;}
    .close-btn{position:absolute;top:8px;left:15px;font-size:2.1em;color:var(--green);background:none;border:none;cursor:pointer;z-index:2;}
    .share-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.28);backdrop-filter:blur(1.5px);z-index:1999;display:none;}
    .share-overlay.active{display:block;}
    .share-popup{background:var(--glass-bg);box-shadow:0 8px 32px #34d39933;padding:27px 18px 22px;border-radius:17px;max-width:97vw;width:390px;display:none;flex-direction:column;align-items:center;position:fixed;right:50%;top:50%;transform:translate(50%,-50%);z-index:2000;backdrop-filter:blur(11px);direction: rtl;}
    .share-popup.active{display:flex;}
    .share-popup-title{font-weight:700;color:#25ba7b;font-size:1.1em;margin-bottom:13px;font-family:'Cairo','Tajawal','Almarai';}
    .share-popup input{width:99%;margin-top:9px;padding:10px 12px;border-radius:11px;border:1.5px solid #dddddd;font-size:0.99em; background: #fff;direction: ltr;text-align: left;}
    .share-popup input:focus{outline:none;border-color:var(--green);}
    .share-popup .copy-btn{margin-top:14px;background:var(--gradient);color:#fff;font-weight:700;border:none;border-radius:11px;padding:11px 27px;cursor:pointer;font-size:1em;display: flex;align-items: center;gap: 7px;flex-direction: row-reverse;}
    .share-popup .copy-btn:active {
      box-shadow:0 4px 20px #34d39933;
      transform: scale(1.07);
    }
    .share-popup .copied{display:none;margin-top:8px;color:var(--green);font-weight:700;}
    .share-popup .copied.active{display:block;}
    @media (max-width:800px){.bikes-list{grid-template-columns:1fr;}.badge{right:9px;top:9px;} .add-bike-form{padding: 18px 7px;} .footer{font-size:0.97em;} .bike-name{font-size:1em;} .bike-card{padding:18px 7px 15px;} }
    @media (max-width:520px){.header{padding:24px 4px 11px;} .glass{padding:10px 7px;} .search-bar-box{max-width:99vw;} }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div class="glass">
      <img src="https://i.postimg.cc/kgrvnzGZ/image-2-Photoroom.png" class="logo" alt="Ø´Ø¹Ø§Ø± Ù…Ø§Ù„ÙˆÙƒ Ø¨Ø§ÙŠÙƒ">
      <div class="title">Mallouk Bike </div>
      <div class="subtitle">Ø§Ù‡Ù„Ø§ Ø¨Ùƒ ÙÙŠ Ù…ØªØ¬Ø±Ù†Ø§ ğŸ›’ğŸš€</div>
      <div class="search-bar-box">
        <input type="text" class="search-bar" id="searchBar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." autocomplete="off">
        <span class="search-icon"><i class="fa fa-search"></i></span>
      </div>
      <div class="whatsapp-contact-row">
        <a href="https://wa.me/96170323991" target="_blank" rel="noopener noreferrer" class="whatsapp-contact-btn">
          <span style="margin-left:8px;"><i class="fab fa-whatsapp" aria-hidden="true"></i></span>
          <span>Ø§ØªØµÙ„ Ø¨Ù†Ø§</span>
        </a>
      </div>
      <div id="admin-login-container" style="margin-top:16px;text-align:center;">
        <button id="login-btn" class="add-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„</button>
        <button id="logout-btn" class="add-btn" style="display:none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>
    <div class="category-filters" id="categoryFilters"></div>
    <div class="counter" id="counter"></div>
    <div id="admin-stats" style="display:none;margin:20px auto;max-width:420px;background:#fff;padding:18px;border-radius:15px;box-shadow:0 4px 20px #0002;text-align:center;">
        <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
        <p>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: <b id="total-visits">0</b></p>
    </div>

  </div>

  <!-- FORMULAIRE AJOUT PRODUIT (cachÃ© par dÃ©faut) -->
  <div class="add-bike-form" id="add-bike-form" style="display:none;">
    <div class="form-title">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ ğŸš²ğŸ›´</div>
    <input type="text" id="newBikeName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <select id="newBikeCategory">
      <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
      <option value="vtt">Ø¯Ø±Ø§Ø¬Ø§Øª Ø¬Ø¨Ù„ÙŠØ©</option>
      <option value="route">Ø¯Ø±Ø§Ø¬Ø§Øª Ø³ÙŠØ§Ø­ÙŠ</option>
      <option value="trottinette">Ø³ÙƒÙˆØªØ±</option>
      <option value="accessoires">Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</option>
      <option value="malhekat">Ù…ØªÙØ±Ù‚Ø§Øª</option>
      <option value="mecanique">Ù…ÙŠÙƒØ§Ù†ÙŠÙƒ</option>
      <option value="enfant">Ø¯Ø±Ø§Ø¬Ø§Øª ÙˆÙ„Ø§Ø¯ÙŠ</option>
    </select>
    <input type="text" id="newBikeDesc" placeholder="Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
    <input type="file" id="newBikeImgFile" accept="image/*">
    <button class="add-btn" id="addBikeBtn"><i class="fa fa-plus-circle"></i>Ø¥Ø¶Ø§ÙØ©</button>
    <span class="msg" id="addBikeMsg"></span>
  </div>

  <!-- LISTE DES PRODUITS -->
  <div class="bikes-list" id="bikesList"></div>
  <div class="no-result" id="noResult" style="display:none;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø¨Ø­Ø«Ùƒ... ğŸ˜”</div>

  <!-- POPUP ZOOM IMAGE -->
  <div class="popup-overlay" id="popup">
    <div class="popup-img-box">
      <button class="close-btn" onclick="closePopup()"><i class="fa fa-times"></i></button>
      <img src="" class="popup-img" id="popup-img" alt="ØªÙƒØ¨ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬" />
    </div>
  </div>

  <!-- PARTAGE PRODUIT -->
  <div class="share-overlay" id="share-overlay" onclick="closeShare()"></div>
  <div class="share-popup" id="share-popup">
    <button class="close-btn" onclick="closeShare()"><i class="fa fa-times"></i></button>
    <div class="share-popup-title">Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ğŸš´</div>
    <input type="text" id="share-link" readonly value="">
    <button class="copy-btn" id="copy-share-btn"><i class="fa fa-copy"></i>Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
    <span class="copied" id="copied-msg"><i class="fa fa-check"></i> ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!</span>
  </div>

  <div class="footer">
    Â© Mallouk Bike  â€“ Ø´Ø§Ø±Ùƒ ÙˆØ²Ø±Ù†Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹!
  </div>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyCqr8cCSO_RZRxNWdz75DAJJsHxNLXS9Jc",
    authDomain: "mallouk-bike.firebaseapp.com",
    databaseURL: "https://mallouk-bike-default-rtdb.firebaseio.com",
    projectId: "mallouk-bike",
    storageBucket: "mallouk-bike.firebasestorage.app",
    messagingSenderId: "847523992830",
    appId: "1:847523992830:web:210166ba53b3220bc281af",
    measurementId: "G-GQF1FPY409"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);



    function listenStats(){
        db.ref("stats/visits").on("value", snap=>{
            document.getElementById("total-visits").textContent = snap.val() || 0;
        });
    }


    // === STATS : VISITES SITE (1 par session) ===
    if (!sessionStorage.getItem("site_visited")) {
    db.ref("stats/visits").transaction(count => (count || 0) + 1);
    sessionStorage.setItem("site_visited", "1");
    }



    const CATEGORIES = [
    {id:'vtt',label:'Ø¯Ø±Ø§Ø¬Ø§Øª Ø¬Ø¨Ù„ÙŠØ©',badge:'vtt'},
    {id:'route',label:'Ø¯Ø±Ø§Ø¬Ø§Øª Ø³ÙŠØ§Ø­ÙŠ',badge:'route'},
    {id:'trottinette',label:'Ø³ÙƒÙˆØªØ±',badge:'trottinette'},
    {id:'accessoires',label:'Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª',badge:'accessoires'},
    {id:'malhekat',label:'Ù…ØªÙØ±Ù‚Ø§Øª',badge:'malhekat'},
    {id:'mecanique',label:'Ù…ÙŠÙƒØ§Ù†ÙŠÙƒ',badge:'mecanique'},
    {id:'enfant',label:'Ø¯Ø±Ø§Ø¬Ø§Øª ÙˆÙ„Ø§Ø¯ÙŠ',badge:'enfant'}
    ];
    const CATEGORY_LOOKUP = Object.fromEntries(CATEGORIES.map(c => [c.id, c]));

    let allBikes = [];
    let renderTimer = null;
    let currentCategory = 'all';
    let currentSearch = '';
    let highlightBikeId = null;
    let highlightTimeout = null;
    let isAdmin = false; // <-- AJOUTÃ‰

    // INIT
    renderCategoryFilters();
    attachSearchHandler();
    getHighlightFromUrl();
    loadBikesRealtime();
    setCategoryFilterActive('all');

    // === AUTH LOGIC ===
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const addBikeForm = document.getElementById('add-bike-form');

    loginBtn.onclick = async () => {
    const email = prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„:");
    const password = prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
    try {
        await auth.signInWithEmailAndPassword(email, password);
        alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„!");
    } catch(e) {
        alert("â›” ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + e.message);
    }
    };

    logoutBtn.onclick = async () => {
    await auth.signOut();
    alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬!");
    };

    // === ON AUTH STATE CHANGE ===
    auth.onAuthStateChanged(user => {
    if(user){
        isAdmin = true;
        addBikeForm.style.display = 'block';
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        document.getElementById("admin-stats").style.display = "block";
        listenStats();

    } else {
        isAdmin = false;
        addBikeForm.style.display = 'none';
        loginBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        document.getElementById("admin-stats").style.display = "none";
    }
    delayedRender(); // <-- Rerender pour mettre Ã  jour boutons admin
    });

    // === RENDER & FILTER FUNCTIONS ===
    function renderCategoryFilters() {
    const filters = document.getElementById('categoryFilters');
    filters.innerHTML = '';
    const btnAll = document.createElement('button');
    btnAll.className = 'filter-btn active';
    btnAll.textContent = 'Ø§Ù„ÙƒÙ„';
    btnAll.onclick = () => { filterByCategory('all'); removeBikeIdFromUrl(); };
    btnAll.id = 'filter-btn-all';
    filters.appendChild(btnAll);
    CATEGORIES.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.textContent = cat.label;
        btn.onclick = () => filterByCategory(cat.id);
        btn.id = 'filter-btn-' + cat.id;
        filters.appendChild(btn);
    });
    }
    function setCategoryFilterActive(category) {
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
    if(category === 'all') document.getElementById('filter-btn-all').classList.add('active');
    else {
        const btn = document.getElementById('filter-btn-' + category);
        if(btn) btn.classList.add('active');
    }
    }
    function filterByCategory(catId) {
    currentCategory = catId;
    setCategoryFilterActive(catId);
    delayedRender(true);
    }

    function attachSearchHandler() {
    document.getElementById('searchBar').addEventListener('input', function(){
        currentSearch = this.value.trim().toLowerCase();
        delayedRender();
    });
    }

    function loadBikesRealtime() {
    db.ref('mallouk_bikes').on('value', snapshot => {
        const bikesObj = snapshot.val() || {};
        allBikes = Object.entries(bikesObj).map(([bikeId, bike]) => ({...bike, id: bikeId}));
        delayedRender();
    });
    }
    function delayedRender(animation = false) {
    if(renderTimer) clearTimeout(renderTimer);
    renderTimer = setTimeout(() => renderBikes(animation), 80);
    }

    function incrementProductView(bikeId){
    db.ref("stats/views/" + bikeId).transaction(v => (v || 0) + 1);
    }


    function renderBikes(animate = false) {
    let bikes = allBikes;
    if(currentSearch){
        bikes = bikes.filter(bike=>{
        const name = bike.name?.toLowerCase() || '';
        const desc = bike.desc?.toLowerCase() || '';
        const cat = bike.category?.toLowerCase() || '';
        return name.includes(currentSearch) || desc.includes(currentSearch) || (CATEGORY_LOOKUP[cat]?.label.toLowerCase().includes(currentSearch));
        });
    }
    if(currentCategory !== 'all') bikes = bikes.filter(bike => bike.category === currentCategory);
    bikes = bikes.slice().sort((a,b) => b.id - a.id);

    const list = document.getElementById('bikesList');
    list.innerHTML = '';
    document.getElementById('counter').textContent = bikes.length ? (`${bikes.length} Ù…Ù†ØªØ¬${bikes.length === 1 ? '' : 'Ø§Øª'} Ù…Ø¹Ø±ÙˆØ¶Ø©`) : '';
    document.getElementById('noResult').style.display = bikes.length ? 'none' : 'block';
    if(!bikes.length) return;

    bikes.forEach((bike,i)=>{
        const card = document.createElement('div');
        card.className = 'bike-card';
        card.setAttribute('data-id', bike.id);
        card.style.animationDelay = animate ? (i*40)+'ms' : '0ms';
        let badgeClass = CATEGORY_LOOKUP[bike.category]?.badge || '';
        let badgeLabel = CATEGORY_LOOKUP[bike.category]?.label || bike.category || '';
        card.innerHTML = `
        <span class="badge ${badgeClass}">${badgeLabel}</span>
        <img src="${bike.img}" class="bike-img" alt="${bike.name}" data-name="${bike.name}" data-id="${bike.id}">
        <div class="bike-name">${bike.name}</div>
        <div class="bike-desc">${bike.desc ? bike.desc : ''}</div>
        <div class="card-btns">
            <button class="share-btn" onclick="shareBikeById('${bike.id}')"><i class="fa fa-share-alt"></i>Ù…Ø´Ø§Ø±ÙƒØ©</button>
            <button class="delete-btn" style="display:${isAdmin ? 'inline-flex':'none'};" onclick="deleteBike('${bike.id}')"><i class="fa fa-trash"></i>Ø­Ø°Ù</button>
        </div>
        `;
        // === VUES PRODUIT (ADMIN SEULEMENT) ===
        if(isAdmin){
            const viewsDiv = document.createElement("div");
            viewsDiv.style.marginTop = "8px";
            viewsDiv.style.fontSize = "0.9em";
            viewsDiv.style.fontWeight = "700";
            viewsDiv.textContent = "ğŸ‘ï¸ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª: ...";

            db.ref("stats/views/" + bike.id).get().then(snap=>{
                viewsDiv.textContent = "ğŸ‘ï¸ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª: " + (snap.val() || 0);
            });


            card.appendChild(viewsDiv);
        }

        list.appendChild(card);
    });
    attachZoom();
    highlightBikeIfNeeded();
    }

    // === ZOOM IMAGE ===
    const popup = document.getElementById('popup');
    const popupImg = document.getElementById('popup-img');
    function attachZoom() {
    document.querySelectorAll('.bike-img').forEach(img => {
        img.onclick = function() {
            const bikeId = this.dataset.id;
            incrementProductView(bikeId);
            popupImg.src = this.src;
            popup.classList.add('active');
        }

    });
    }
    function closePopup() { popup.classList.remove('active'); popupImg.src=""; }
    window.closePopup = closePopup;
    popup.addEventListener('click', e => { if(e.target === popup) closePopup(); });
    document.addEventListener('keydown', e => { if(e.key==='Escape'){closePopup();closeShare();} });

    // === SHARE ===
    function shareBikeById(bikeId){
    const url = window.location.origin + window.location.pathname + '?bike_id=' + encodeURIComponent(bikeId);
    if(navigator.share){
        const bike = allBikes.find(b=>b.id==bikeId);
        const title = bike?.name || 'Ù…Ù†ØªØ¬ Ù…Ù† Mallouk Bike';
        const text = bike?.desc ? bike.desc + ' - Ù…Ù† Mallouk Bike' : 'Ù…Ù† Mallouk Bike';
        navigator.share({title,text,url}).catch(()=>{openSharePopup(url);});
    } else openSharePopup(url);
    }
    function openSharePopup(url){
    document.getElementById('share-popup').classList.add('active');
    document.getElementById('share-overlay').classList.add('active');
    document.getElementById('share-link').value = url;
    document.getElementById('copied-msg').classList.remove('active');
    document.getElementById('copy-share-btn').onclick = function() {
        let input = document.getElementById('share-link');
        input.select();
        input.setSelectionRange(0, 99999);
        document.execCommand('copy');
        document.getElementById('copied-msg').classList.add('active');
        setTimeout(()=>{document.getElementById('copied-msg').classList.remove('active');},1400);
    }
    }
    function closeShare(){ document.getElementById('share-popup').classList.remove('active'); document.getElementById('share-overlay').classList.remove('active'); }
    window.closeShare = closeShare;

    // === ADD/DELETE ===
    document.getElementById('addBikeBtn').onclick = function(){
    const msg = document.getElementById('addBikeMsg');
    const btn = this;
    const name = document.getElementById('newBikeName').value.trim();
    const category = document.getElementById('newBikeCategory').value;
    const desc = document.getElementById('newBikeDesc').value.trim();
    const fileInput = document.getElementById('newBikeImgFile');
    const file = fileInput.files[0];
    if(!name||!category||!file){ msg.textContent="âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!"; msg.style.color="#d9303e"; return; }
    btn.disabled=true; btn.innerHTML='<span class="loading"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...';
    msg.textContent="";
    const reader = new FileReader();
    reader.onload = e=>{
        const imgData = e.target.result;
        const bikeId = Date.now()+Math.floor(Math.random()*10000);
        db.ref('mallouk_bikes/'+bikeId).set({name,category,desc,img:imgData},error=>{
        btn.disabled=false; btn.innerHTML='<i class="fa fa-plus-circle"></i>Ø¥Ø¶Ø§ÙØ©';
        if(!error){
            msg.textContent="âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬!"; msg.style.color="#16a085";
            setTimeout(()=>{msg.textContent="";},1800);
            document.getElementById('newBikeName').value="";
            document.getElementById('newBikeCategory').value="";
            document.getElementById('newBikeDesc').value="";
            fileInput.value="";
        } else { msg.textContent="âŒ ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬"; msg.style.color="#d9303e"; }
        });
    };
    reader.readAsDataURL(file);
    }

    window.deleteBike = function(bikeId){
    if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) db.ref('mallouk_bikes/'+bikeId).remove();
    }

    // === HIGHLIGHT BIKE ===
    function getHighlightFromUrl(){
    const urlParams = new URLSearchParams(window.location.search);
    highlightBikeId = urlParams.get('bike_id');
    }
    function highlightBikeIfNeeded(){
        if(highlightBikeId){
            incrementProductView(highlightBikeId);

            const el = document.querySelector(`.bike-card[data-id='${highlightBikeId}']`);
            if(el){
            el.style.border='2px solid #ffd94a';
            el.scrollIntoView({behavior:'smooth',block:'center'});
            setTimeout(()=>{if(el) el.style.border='1px solid #ccc';},4500);
            }
    }
    }
    function removeBikeIdFromUrl(){
    const url = new URL(window.location);
    url.searchParams.delete('bike_id');
    window.history.replaceState({}, '', url);
    }
  </script>
</body>
</html>
